<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Magical Santa Tracker</title>
    <!-- CesiumJS CSS and JS -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.133/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.133/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <!-- EmailJS for direct form submission -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(to bottom, #001f3f, #87CEEB); color: #fff; margin: 0; padding: 0; }
        #tabs { display: flex; background: #ff0000; justify-content: center; flex-wrap: wrap; }
        #tabs button { padding: 15px 20px; background: none; border: none; color: white; font-size: 18px; cursor: pointer; transition: background 0.3s; }
        #tabs button:hover, #tabs button.active { background: #cc0000; }
        .tab-content { display: none; padding: 20px; text-align: center; min-height: 600px; }
        .tab-content.active { display: block; }
        h1, h2 { color: #ff0000; text-shadow: 0 0 10px #fff; }
        #villageContainer { height: 500px; width: 100%; background: #001f3f; margin: 20px auto; border-radius: 10px; overflow: hidden; }
        #cesiumContainer { height: 500px; width: 80%; margin: 20px auto; border: 2px solid #ff0000; border-radius: 10px; }
        #countdown { font-size: 28px; margin: 20px; color: #ffd700; text-shadow: 0 0 5px #ff0000; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { text-shadow: 0 0 5px #ff0000; } to { text-shadow: 0 0 20px #ff0000; } }
        #quiz { margin: 20px; max-width: 600px; margin: auto; }
        button:not(#tabs button) { padding: 10px 20px; background: #228b22; color: white; border: none; cursor: pointer; margin: 10px; border-radius: 5px; transition: all 0.3s; }
        button:not(#tabs button):hover { background: #006400; box-shadow: 0 0 10px #ffd700; transform: scale(1.05); }
        #letterForm { margin: 20px auto; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; width: 80%; max-width: 500px; }
        #letterForm input, #letterForm textarea { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #fff; }
        #letterForm button { background: #ff0000; width: 100%; font-size: 16px; }
        .catalogue-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .toy-item { background: white; border: 2px solid #ff0000; border-radius: 10px; padding: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); color: #333; transition: transform 0.3s; }
        .toy-item:hover { transform: scale(1.05); }
        .toy-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
        .toy-name { font-weight: bold; color: #ff0000; }
        #form-status { color: #ffd700; font-weight: bold; margin-top: 10px; }
        #result { color: #ffd700; font-weight: bold; margin: 10px; }
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>
    <div id="tabs">
        <button class="tab-btn active" onclick="openTab('village')">North Pole Village</button>
        <button class="tab-btn" onclick="openTab('tracker')">Santa Tracker</button>
        <button class="tab-btn" onclick="openTab('letter')">Write a Letter to Santa</button>
        <button class="tab-btn" onclick="openTab('catalogue')">Toy Catalogue</button>
        <button class="tab-btn" onclick="openTab('quiz')">Christmas Quiz</button>
    </div>

    <!-- North Pole Village Tab -->
    <div id="village" class="tab-content active">
        <h1>Explore the Enchanted North Pole Village</h1>
        <div id="villageContainer" class="loading">Loading magical village...</div>
        <div id="countdown"></div>
    </div>

    <!-- Santa Tracker Tab -->
    <div id="tracker" class="tab-content">
        <h1>Santa's Magical 3D Journey Tracker</h1>
        <div id="cesiumContainer" class="loading">Loading globe...</div>
        <button id="sleighViewBtn">Switch to Sleigh View</button>
        <button id="globalViewBtn">Back to Global View</button>
        <div id="countdown2"></div>
    </div>

    <!-- Letter to Santa Tab -->
    <div id="letter" class="tab-content">
        <h1>Write a Letter to Santa</h1>
        <p>Share your wishes with Santa‚Äîhe reads every one!</p>
        <form id="letterForm">
            <input type="text" id="user_name" placeholder="Your Name" required><br>
            <input type="email" id="user_email" placeholder="Your Email (optional)"><br>
            <textarea id="message" placeholder="Dear Santa, I wish for..." rows="5" required></textarea><br>
            <button type="submit">Send Letter to Santa! ‚úâÔ∏è</button>
        </form>
        <p id="form-status"></p>
    </div>

    <!-- Toy Catalogue Tab -->
    <div id="catalogue" class="tab-content">
        <h1>Santa's Magical Toy Catalogue üéÅ</h1>
        <p>Pick your favorites‚ÄîSanta's elves are watching! (Just for fun‚Äîno real wishes sent.)</p>
        <div class="catalogue-grid">
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2017/12/20/10/30/christmas-toys-3028079_1280.jpg" alt="Teddy Bear">
                <h3 class="toy-name">Cuddly Teddy Bear</h3>
                <p>Soft and huggable for bedtime stories!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2016/11/29/09/11/christmas-1869572_1280.jpg" alt="Toy Train">
                <h3 class="toy-name">Choo-Choo Train Set</h3>
                <p>Zoom around the tracks with Santa's reindeer!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2016/11/22/21/07/santa-claus-1850827_1280.jpg" alt="Doll">
                <h3 class="toy-name">Pretty Doll</h3>
                <p>Dress up and play tea party at the North Pole.</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2017/10/31/09/43/christmas-2906369_1280.jpg" alt="Building Blocks">
                <h3 class="toy-name">Colorful Building Blocks</h3>
                <p>Build a castle taller than Santa's chimney!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2016/11/19/15/32/christmas-1837881_1280.jpg" alt="Puzzle">
                <h3 class="toy-name">Santa Puzzle</h3>
                <p>Piece together the magic of Christmas!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2017/12/13/00/35/christmas-3016828_1280.jpg" alt="Rocking Horse">
                <h3 class="toy-name">Rocking Horse</h3>
                <p>Gallop like Dasher and Dancer!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2016/12/11/12/07/christmas-1898209_1280.jpg" alt="Board Game">
                <h3 class="toy-name">Elf Adventure Game</h3>
                <p>Play with friends and win elf hats!</p>
            </div>
            <div class="toy-item">
                <img src="https://cdn.pixabay.com/photo/2015/12/01/20/28/black-and-white-1072369_1280.jpg" alt="Snow Globe">
                <h3 class="toy-name">Magical Snow Globe</h3>
                <p>Shake for a flurry of North Pole snow!</p>
            </div>
        </div>
    </div>

    <!-- Quiz Tab -->
    <div id="quiz" class="tab-content">
        <h1>Fun Magical Activity: Christmas Quiz</h1>
        <div id="quiz-content">
            <p id="question"></p>
            <button onclick="checkAnswer(true)">True</button>
            <button onclick="checkAnswer(false)">False</button>
            <p id="result"></p>
        </div>
    </div>

    <!-- Three.js for Enhanced Magical Village Inspired by Image -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.152.2/build/three.module.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { TextureLoader } from 'https://unpkg.com/three@0.152.2/examples/jsm/loaders/TextureLoader.js?module';

        const loader = new TextureLoader();

        // Village Scene setup with crisp rendering
        const villageScene = new THREE.Scene();
        villageScene.fog = new THREE.Fog(0x001122, 20, 150); // Dark blue fog for night sky
        const villageCamera = new THREE.PerspectiveCamera(75, window.innerWidth / 500, 0.1, 1000);
        const villageRenderer = new THREE.WebGLRenderer({ antialias: true });
        villageRenderer.setSize(window.innerWidth, 500);
        villageRenderer.shadowMap.enabled = true;
        villageRenderer.shadowMap.type = THREE.PCFSoftShadowMap; // Crisp shadows
        document.getElementById('villageContainer').appendChild(villageRenderer.domElement);

        // Enhanced Lighting for night magic
        const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
        villageScene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
        directionalLight.position.set(10, 20, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        villageScene.add(directionalLight);

        // Snowy Ground with texture (central square)
        const snowTexture = loader.load('https://opengameart.org/sites/default/files/snow01.png');
        const groundGeometry = new THREE.PlaneGeometry(100, 100);
        const groundMaterial = new THREE.MeshLambertMaterial({ map: snowTexture });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = Math.PI / 2;
        ground.receiveShadow = true;
        villageScene.add(ground);

        // Load wood and brick textures
        const woodTexture = loader.load('https://cdn.pixabay.com/photo/2015/11/19/21/11/wood-1006705_1280.jpg');
        const brickTexture = loader.load('https://threejs.org/examples/textures/brick_diffuse.jpg'); // Placeholder brick

        // Central Giant Christmas Tree
        const treeTrunkGeometry = new THREE.CylinderGeometry(1, 1.5, 8, 32);
        const treeTrunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
        const centralTrunk = new THREE.Mesh(treeTrunkGeometry, treeTrunkMaterial);
        centralTrunk.position.set(0, 4, 0);
        centralTrunk.castShadow = true;
        villageScene.add(centralTrunk);
        // Foliage layers for big tree
        for (let level = 0; level < 3; level++) {
            const foliageGeometry = new THREE.ConeGeometry(8 - level * 2, 10 - level * 3, 32);
            const foliageMaterial = new THREE.MeshLambertMaterial({ color: 0x228b22 });
            const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
            foliage.position.set(0, 10 - level * 3, 0);
            foliage.castShadow = true;
            villageScene.add(foliage);
        }
        // Star on top
        const starGeometry = new THREE.SphereGeometry(1, 32, 32);
        const starMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00, emissive: 0xffff00 });
        const star = new THREE.Mesh(starGeometry, starMaterial);
        star.position.set(0, 25, 0);
        villageScene.add(star);
        // Tree lights
        const treeLightColors = [0xff0000, 0xffff00, 0x00ff00, 0x0000ff];
        for (let i = 0; i < 50; i++) {
            const light = new THREE.PointLight(treeLightColors[Math.floor(Math.random() * 4)], 0.5, 5);
            light.position.set((Math.random() - 0.5) * 10, Math.random() * 20 + 5, (Math.random() - 0.5) * 10);
            villageScene.add(light);
        }

        // Arched Colonnade Buildings around central square
        const archGeometry = new THREE.BoxGeometry(20, 10, 5); // Base
        const archMaterial = new THREE.MeshLambertMaterial({ map: brickTexture });
        for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 2) {
            const arch = new THREE.Mesh(archGeometry, archMaterial);
            arch.position.set(Math.cos(angle) * 15, 5, Math.sin(angle) * 15);
            arch.rotation.y = angle;
            arch.castShadow = true;
            villageScene.add(arch);
            // Arches (simple cylinders for columns)
            for (let col = 0; col < 5; col++) {
                const columnGeometry = new THREE.CylinderGeometry(0.5, 0.5, 10, 32);
                const columnMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const column = new THREE.Mesh(columnGeometry, columnMaterial);
                const colAngle = angle + (col - 2) * 0.2;
                column.position.set(Math.cos(colAngle) * 15, 5, Math.sin(colAngle) * 15);
                column.castShadow = true;
                villageScene.add(column);
            }
            // Roof
            const roofGeometry = new THREE.BoxGeometry(20, 2, 6);
            const roofMaterial = new THREE.MeshLambertMaterial({ color: 0x0000ff }); // Blue roofs
            const roof = new THREE.Mesh(roofGeometry
